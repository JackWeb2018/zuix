/*

 Copyright 2015-2017 G-Labs. All Rights Reserved.
         https://genielabs.github.io/zuix

 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.
*/
'use strict';!function(A){if("object"==typeof exports)module.exports=A();else if("function"==typeof define&&define.amd)define(A);else{var n;"undefined"!=typeof window?n=window:"undefined"!=typeof global?n=global:"undefined"!=typeof self&&(n=self);n.zuix=A()}}(function(){return function n(p,r,b){function h(a,d){if(!r[a]){if(!p[a]){var e="function"==typeof require&&require;if(!d&&e)return e(a,!0);if(c)return c(a,!0);throw Error("Cannot find module '"+a+"'");}e=r[a]={exports:{}};p[a][0].call(e.exports,
function(c){var f=p[a][1][c];return h(f?f:c)},e,e.exports,n,p,r,b)}return r[a].exports}for(var c="function"==typeof require&&require,d=0;d<b.length;d++)h(b[d]);return h}({1:[function(n,p,r){function b(a){h=window?window.console:{};this._timers={};this.args=function(a,c,d){a="%c "+c+" %c"+(new Date).toISOString()+" %c"+a;c=["background-color:rgba(200,200,200,0.2);color:#8a53ff;","background-color:rgba(200,200,200,0.2);color:#777777","background-color:rgba(200,200,200,0.2);color:#888888;"];for(var f=
0;f<d.length;f++)if("string"==typeof d[f]&&0==d[f].indexOf("timer:")){var k=d[f].split(":");if(3==k.length)switch(k[2]){case "start":this._timers[k[1]]=(new Date).getTime();a+=" %cSTART "+k[1];c.push("background-color:rgba(200,200,200,0.2);color:#999900;");break;case "stop":a+=" %cSTOP "+k[1]+" "+((new Date).getTime()-this._timers[k[1]])+" ms",c.push("background-color:rgba(200,200,200,0.2);color:#00aa00;")}}a+=" \n%c ";c.push("background-color:transparent;color:inherit;");for(f=c.length-1;0<=f;f--)Array.prototype.unshift.call(d,
c[f]);Array.prototype.unshift.call(d,a);Array.prototype.push.call(d,"\n\n")};this.log=function(c,b){"function"===typeof d&&d.call(a,c,b);this.args(a,c,b);h.log.apply(h,b)}}var h=null,c="log info warn error debug trace dir group groupCollapsed groupEnd time timeEnd profile profileEnd dirxml assert count markTimeline timeStamp clear".split(" "),d=null;b.prototype.monitor=function(a){d=a};b.prototype.console=function(a){if(a)window.console=h;else for(window.console={},a=0;a<c.length;a++)window.console[c[a]]||
(window.console[c[a]]=function(){})};b.prototype.i=b.prototype.info=b.prototype.l=b.prototype.log=function(){this.log("INFO",arguments);return this};b.prototype.w=b.prototype.warn=function(){this.log("WARN",arguments);return this};b.prototype.e=b.prototype.error=function(){this.log("ERROR",arguments);return this};b.prototype.d=b.prototype.debug=function(){this.log("DEBUG",arguments);return this};b.prototype.t=b.prototype.trace=function(){this.log("TRACE",arguments);return this};p.exports=function(a){return new b(a)}},
{}],2:[function(n,p,r){function b(c){var d=this;d._worker=null;d._taskList=[];d._requests=[];null==c&&(c=function(){});d.taskQueue=function(a,b,e){d._taskList.push({tid:a,fn:b,status:0,priority:e,step:function(a){h.t(a,"load:step");c(d,"load:step",{task:a})},end:function(){this.status=2;h.t(this.tid,"load:next","timer:task:stop");c(d,"load:next",{task:this.tid});d._taskList.splice(this.index,1);d.taskCheck();null!=this._callback&&this._callback.call(this)},callback:function(a){this._callback=a}});
h.t(a,"task added",e,"priority");d._taskList.sort(function(a,c){return a.priority>c.priority?1:c.priority>a.priority?-1:0});d.taskCheck()};d.taskCheck=function(){for(var a=0;a<d._taskList.length;a++){if(0==d._taskList[a].status){d._taskList[a].status=1;h.t(d._taskList[a].tid,"load:begin","timer:task:start");c(d,"load:begin",{task:d._taskList[a].tid});d._taskList[a].index=a;d._taskList[a].fn.call(d._taskList[a]);return}if(1==d._taskList[a].status||2==d._taskList[a].status)return}h.t("load:end");c(d,
"load:end")}}var h=n("./Logger")("TaskQueue.js");b.prototype.queue=function(c,d,a){return this.taskQueue(c,d,a)};b.prototype.requestLock=function(c){return null!=c._taskerLock?!1:c._taskerLock=!0};b.prototype.releaseLock=function(c){setTimeout(function(){delete c._taskerLock},100)};b.prototype.lockLater=function(c,d,a){var b=this;null==c._taskerLock?d():null==c._taskerTimeout&&(c._taskerTimeout=!0,c._taskerTimeout=setTimeout(function(){delete c._taskerTimeout;b.lockLater(c,d,a)},a));return!0};p.exports=
b},{"./Logger":1}],3:[function(n,p,r){p.exports={isIE:function(){return 0<window.navigator.userAgent.indexOf("Trident")},isNoU:function(b){return"undefined"===typeof b||null===b},isFunction:function(b){return"function"===typeof b},objectEquals:function(b,h){if(null===b||void 0===b||null===h||void 0===h)return b===h;if(b.constructor!==h.constructor)return!1;if(b instanceof Function||b instanceof RegExp)return b===h;if(b===h||b.valueOf()===h.valueOf())return!0;if(Array.isArray(b)&&b.length!==h.length||
b instanceof Date||!(b instanceof Object)||!(h instanceof Object))return!1;var c=Object.keys(b);return Object.keys(h).every(function(d){return-1!==c.indexOf(d)})&&c.every(function(c){return util.objectEquals(b[c],h[c])})},propertyFromPath:function(b,h){if("string"===typeof h){h=h.replace(/\[(\w+)]/g,".$1");h=h.replace(/^\./,"");for(var c=h.split("."),d=b,a=0,n=c.length;a<n;++a){var e=c[a];if("undefined"!==typeof d[e])d=d[e];else return}return d}},cloneObject:function h(c){if(null===c||"object"!==
typeof c)return c;var d=c.constructor(),a;for(a in c)d[a]=h(c[a]);return d},evalJs:eval}},{}],4:[function(n,p,r){function b(a){d(this,a.type,a)}function h(a,c,d){var e=!1;f.each(g,function(){if(this.element===a&&this.path===c&&this.handler==d)return x.w("Handler already registered",a,c,d),e=!0,!1});e||(g.push({element:a,path:c,handler:d}),a.addEventListener(c,b,!1))}function c(a,c,d){var e=1,h=-1;f.each(g,function(f){this.element===a&&this.path===c&&this.handler==d&&(e--,h=f)});-1!==h&&g.splice(h,
1);0==e&&a.removeEventListener(c,b)}function d(a,c,d){var b=f(a);f.each(g,function(){this.element===a&&this.path===c&&this.handler.call(b,d)})}function a(k){this._selection=[];"undefined"===typeof k&&(k=document.documentElement);if(k instanceof a)return k;if(k instanceof HTMLCollection||k instanceof NodeList||Array.isArray(k))this._selection=k;else if(k instanceof HTMLElement||k instanceof Node)this._selection=[k];else if("string"===typeof k)this._selection=document.documentElement.querySelectorAll(k);
else if(null!==k)throw x.e("ZxQuery cannot wrap object of this type.",typeof k,k),Error(),k;return this}var x=n("./Logger")("TaskQueue.js"),e=n("./Util.js"),g=[];a.prototype.length=function(){return this._selection.length};a.prototype.parent=function(k){return e.isNoU(k)?new a(this._selection[0].parentNode):new a(f.getClosest(this._selection[0],k))};a.prototype.children=function(k){return e.isNoU(k)?new a(this._selection[0].children):new a(this._selection[0].querySelectorAll(k))};a.prototype.reverse=
function(){this._selection=Array.prototype.slice.call(this._selection,0).reverse();return this};a.prototype.get=function(a){e.isNoU(a)&&(a=0);return this._selection[a]};a.prototype.eq=function(k){return new a(this._selection[k])};a.prototype.find=function(k){return new a(this._selection[0].querySelectorAll(k))};a.prototype.each=function(a){f.each(this._selection,a);return this};a.prototype.attr=function(a,c){if(e.isNoU(c))return this._selection[0].getAttribute(a);this.each(function(d,f){this.get().setAttribute(a,
c)});return this};a.prototype.trigger=function(a,c){var d;window.CustomEvent?d=new CustomEvent(a,{detail:c}):(d=document.createEvent("CustomEvent"),d.initCustomEvent(a,!0,!0,c));this.each(function(a,k){k.dispatchEvent(d)});return this};a.prototype.one=function(a,c){var d=!1;this.on(a,function(b,e){d||(d=!0,f(this).off(a,c),c.call(this,b,e))});return this};a.prototype.on=function(a,c){var d=a.match(/\S+/g)||[];this.each(function(a,k){f.each(d,function(a,d){"body"===k.tagName.toLowerCase()&&(k=document);
h(k,d,c)})});return this};a.prototype.off=function(a,d){var b=a.match(/\S+/g)||[];this.each(function(a,k){f.each(b,function(a,f){"body"===k.tagName.toLowerCase()&&(k=document);c(k,f,d)})});return this};a.prototype.isEmpty=function(){return 0===this._selection[0].innerHTML.replace(/\s/g,"").length};a.prototype.position=function(){return null!=this._selection[0]?f.getPosition(this._selection[0]):{x:-1,y:-1,visible:!1}};a.prototype.css=function(a,c){var d=this;if("object"===typeof a)f.each(a,function(a,
k){d.each(function(c,d){d.style[a]=k})});else{if(e.isNoU(c))return this._selection[0].style[a];d.each(function(d,f){f.style[a]=c})}return this};a.prototype.addClass=function(a){var c=a.match(/\S+/g)||[];f.each(this._selection,function(d,b){b.classList?f.each(c,function(a,k){b.classList.add(k)}):b.className+=" "+a});return this};a.prototype.hasClass=function(a){return f.hasClass(this._selection[0],a)};a.prototype.removeClass=function(a){var c=a.match(/\S+/g)||[];f.each(this._selection,function(d,b){b.classList?
f.each(c,function(a,k){b.classList.remove(k)}):b.className=b.className.replace(new RegExp("(^|\\b)"+a.split(" ").join("|")+"(\\b|$)","gi")," ")});return this};a.prototype.prev=function(){return new a(this._selection[0].previousElementSibling)};a.prototype.next=function(){return new a(this._selection[0].nextElementSibling)};a.prototype.html=function(a){if(e.isNoU(a))return this._selection[0].innerHTML;this.each(function(c,d){d.innerHTML=a});return this};a.prototype.append=function(a){"string"===typeof a?
this._selection[0].innerHTML+=a:this._selection[0].appendChild(a);return this};a.prototype.prepend=function(a){"string"===typeof a?this._selection[0].innerHTML=a+this._selection[0].innerHTML:this._selection[0].insertBefore(a,this._selection[0].firstElementChild);return this};a.prototype.display=function(a){if(e.isNoU(a))return this._selection[0].style.display;f.each(this._selection,function(c,d){d.style.display=a});return this};a.prototype.visibility=function(a){if(e.isNoU(a))return this._selection[0].style.visibility;
f.each(this._selection,function(c,d){d.style.visibility=a});return this};a.prototype.show=function(){return this.display("")};a.prototype.hide=function(){return this.display("none")};var f=function(c){return new a(c)};f.find=function(a){return f().find(a)};f.each=function(a,c){var d=null==a?0:Object.keys(a).length;if(0<d){var b=0,e;for(e in a){var g=a[e];g instanceof Element&&(g=f(g));if(!1===c.call(g,e,a[e]))break;b++;if(b>=d)break}}return this};f.hasClass=function(a,c){var d=c.match(/\S+/g)||[],
b=!1;f.each(d,function(c,d){if(b=a.classList?a.classList.contains(d):(new RegExp("(^| )"+d+"( |$)","gi")).test(a.className))return!1});return b};f.ajax=function(a){var c;c=e.isNoU(a)||e.isNoU(a.url)?a:a.url;var d=new XMLHttpRequest;d.open("GET",c);d.onload=function(){200===d.status?e.isFunction(a.success)&&a.success(d.responseText):e.isFunction(a.error)&&a.error(d);e.isFunction(a.then)&&a.then(d)};d.send();return this};f.wrapElement=function(a,c){var d=document.createElement(a);"string"===typeof c?
d.innerHTML=c:d.appendChild(c);return d};f.wrapCss=function(a,c){for(var d=/([.,\w])([^/{};]+)({)/g,b,e=null,g="";b=d.exec(c);){if(null!=e){var e=c.substring(e.index,b.index),h=/(.*)[^s]\{([^\}]+)[\}]/g.exec(e);if(null!=h&&1<h.length){var m=h[1].split(",");f.each(m,function(c,d){g+="\n"+a+"\n"+d;c<m.length-1&&(g+=", ")});g+=" {"+h[2]+"}\n"}else x.w("ZUIX WARNING: z$.wrapCss was unable to parse rule.",h,e)}e=b}null!=e&&(g+=a+" "+c.substring(e.index));""!=g&&(c=g);return c};f.appendCss=function(a,c,
d){var b=null,f;"string"===typeof a?(f=document.head||document.getElementsByTagName("head")[0],b=document.createElement("style"),b.type="text/css",b.id=d,b.styleSheet?b.styleSheet.cssText=a:b.appendChild(document.createTextNode(a))):a instanceof Element&&(b=a);e.isNoU(c)||f.removeChild(c);e.isNoU(b)||f.appendChild(b);return b};f.getClosest=function(a,c){for(;a&&a!==document;a=a.parentNode)if(a.matches(c))return a;return null};f.getPosition=function(a){for(var c=f.isInView(a),d=0,b=0;a;){if("BODY"==
a.tagName)var e=a.scrollTop||document.documentElement.scrollTop,d=d+(a.offsetLeft-(a.scrollLeft||document.documentElement.scrollLeft)+a.clientLeft),b=b+(a.offsetTop-e+a.clientTop);else d+=a.offsetLeft-a.scrollLeft+a.clientLeft,b+=a.offsetTop-a.scrollTop+a.clientTop;a=a.offsetParent}return{x:d,y:b,visible:c}};f.isInView=function(a){if(null===a.offsetParent)return!1;a=a.getBoundingClientRect();return 0<a.bottom&&0<a.right&&a.left<(window.innerWidth||document.documentElement.clientWidth)&&a.top<(window.innerHeight||
document.documentElement.clientHeight)};f.ZxQuery=a;Element.prototype.matches||(Element.prototype.matches=Element.prototype.matchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector||Element.prototype.oMatchesSelector||Element.prototype.webkitMatchesSelector||function(a){a=(this.document||this.ownerDocument).querySelectorAll(a);for(var c=a.length;0<=--c&&a.item(c)!==this;);return-1<c});(function(){function a(c,d){d=d||{bubbles:!1,cancelable:!1,detail:void 0};var b=
document.createEvent("CustomEvent");b.initCustomEvent(c,d.bubbles,d.cancelable,d.detail);return b}if("function"===typeof window.CustomEvent)return!1;a.prototype=window.Event.prototype;window.CustomEvent=a})();p.exports=f},{"./Logger":1,"./Util.js":3}],5:[function(n,p,r){n=n("./zuix/Zuix.js");"object"===typeof p&&p.exports?p.exports=n.call(this):this.zuix=n.call(this)},{"./zuix/Zuix.js":8}],6:[function(n,p,r){function b(a,c){this._options=null;this.contextId=null==a||null==a.contextId?null:a.contextId;
this.componentId=null;this.trigger=function(a,d,b){"function"===typeof c&&c(a,d,b)};this.behavior=this._controller=this._style=this._css=this._view=this._model=this._container=null;this._eventMap=[];this._behaviorMap=[];this._c=null;this.options(a);return this}var h=n("../helpers/Logger")("ComponentContext.js"),c=n("../helpers/ZxQuery"),d=n("../helpers/Util");b.prototype.container=function(a){if(null==a)return this._container;a instanceof c.ZxQuery&&(a=a.get());this._container=a;return this};b.prototype.view=
function(a){if("undefined"===typeof a)return this._view;a instanceof c.ZxQuery&&(a=a.get());"string"===typeof a?(a={content:a},this.trigger(this,"html:parse",a),a=a.content,null!=this._container?(this._view=this._container,this._view.innerHTML+=a):(a=c.wrapElement("div",a),null!=this._view?this._view.innerHTML=a.innerHTML:this._view=a),c(this._view).find("script").each(function(a,c){"true"!==this.attr("zuix-loaded")&&(this.attr("zuix-loaded","true"),eval.call(window,c.innerHTML))}),this.trigger(this,
"view:process",c(this._view))):(a instanceof c.ZxQuery&&(a=a.get()),null!=this._container?(this._view=c.wrapElement("div",a.outerHTML).firstElementChild,this._view.removeAttribute("data-ui-view"),this._container.appendChild(this._view),this._view=this._container):this._view=a);a=c(this._view);!1===this._options.css?a.addClass("zuix-css-ignore"):a.removeClass("zuix-css-ignore");this.modelToView();return this};b.prototype.style=function(a){if("undefined"===typeof a)return this._style;null==a||a instanceof
Element?(this._css=a instanceof Element?a.innerText:a,this._style=c.appendCss(a,this._style,this.componentId)):"string"===typeof a&&(this._css=a,a=c.wrapCss('[data-ui-component="'+this.componentId+'"]:not(.zuix-css-ignore)',a),a={content:a},this.trigger(this,"css:parse",a),a=a.content,this._style=c.appendCss(a,this._style,this.componentId));return this};b.prototype.model=function(a){if("undefined"===typeof a)return this._model;this._model=a;this.modelToView();return this};b.prototype.controller=function(a){if("undefined"===
typeof a)return this._controller;this._controller=a;return this};b.prototype.options=function(a){if(null==a)return this._options;this._options=a;null!=a.componentId&&(this.componentId=a.componentId);this.container(a.container);this.view(a.view);"undefined"!==typeof a.css&&this.style(a.css);this.controller(a.controller);this.model(a.model);return this};b.prototype.on=function(a,c){this._c.on(a,c);return this};b.prototype.loadCss=function(a,b){var e=this;d.isNoU(a)&&(a={});d.isNoU(a.caching)||(b=a.caching);
var g=e.componentId+".css";d.isNoU(a.path)||(g=a.path);b||(g+="?"+(new Date).getTime());c.ajax({url:g,success:function(c){e.style(c);d.isFunction(a.success)&&a.success.call(e,c)},error:function(c){h.e(c,e);d.isFunction(a.error)&&a.error.call(e,c)},then:function(){d.isFunction(a.then)&&a.then.call(e)}});return this};b.prototype.loadHtml=function(a,b){var e=this,g=e.componentId;d.isNoU(a)&&(a={});d.isNoU(a.caching)||(b=a.caching);d.isNoU(a.path)||(g=a.path);var f=c().find('[data-ui-view="'+g+'"]:not([data-ui-component*=""])');
0<f.length()?(g=f.get(0),e.view()===g||null!=e.container()&&e.container().contains(g)?e.view(g):e.view(g.outerHTML),g=e.view().innerHTML,d.isFunction(a.success)&&a.success.call(e,g),d.isFunction(a.then)&&a.then.call(e)):(g==e.componentId&&(g+=".html"+(b?"":"?"+(new Date).getTime())),c.ajax({url:g,success:function(c){e.view(c);d.isFunction(a.success)&&a.success.call(e,c)},error:function(c){h.e(c,e);d.isFunction(a.error)&&a.error.call(e,c)},then:function(){d.isFunction(a.then)&&a.then.call(e)}}));return this};
b.prototype.viewToModel=function(){var a=this;this._model={};c(this._view).find("[data-ui-field]").each(function(c,b){if(0<this.parent("pre,code").length())return!0;var g=this.attr("data-ui-field"),f=!d.isNoU(b.innerHTML)&&d.isIE()?b.cloneNode(!0):b;if(0<g.indexOf(".")){for(var g=g.split("."),k=a._model,h=0;h<g.length-1;h++)"undefined"===typeof k[g[h]]&&(k[g[h]]={}),k=k[g[h]];k[g[g.length-1]]=f}else a._model[g]=f});return this};b.prototype.modelToView=function(){if(null!=this._view&&null!=this._model){var a=
this;c(this._view).find("[data-ui-field]").each(function(b,e){if(0<this.parent("pre,code").length())return!0;var g=this.attr("data-bind-to");null==g&&(g=this.attr("data-ui-field"));if("function"===typeof a._model)a._model.call(c(a._view),this,g);else{var f=d.propertyFromPath(a._model,g);if("function"===typeof f)f.call(c(a._view),this,g);else if(null!=f)switch(e.tagName.toLowerCase()){case "img":e.src=d.isNoU(f.src)?d.isNoU(f.innerHTML)?f:f.innerHTML:f.src;f.alt&&(e.alt=f.alt);break;case "a":e.href=
d.isNoU(f.href)?d.isNoU(f.innerHTML)?f:f.innerHTML:f.href;f.title&&(e.title=f.title);break;case "input":e.value=d.isNoU(f.value)?d.isNoU(f.innerHTML)?f:f.innerHTML:f.value;break;default:e.innerHTML=d.isNoU(f.innerHTML)?f:f.innerHTML}}})}return this};p.exports=b},{"../helpers/Logger":1,"../helpers/Util":3,"../helpers/ZxQuery":4}],7:[function(n,p,r){function b(c){var d=this;this._view=null;this.context=c;this._fieldCache=[];this.destroy=this.create=this.init=null;this._childNodes=[];this.saveView=function(){this.restoreView();
this.view().children().each(function(a,c){d._childNodes.push(c)})};this.restoreView=function(){0<this._childNodes.length&&(d.view().html(""),h.each(d._childNodes,function(a,c){d.view().append(c)}),this._childNodes.length=0)};this.on=function(a,c){this.addEvent(this.view(),a,c);return this};this.mapEvent=function(a,c,d,b){null!=c&&(c.off(d,this.eventRouter),a[d]=b,c.on(d,this.eventRouter))};this.eventRouter=function(a){"function"===typeof c._behaviorMap[a.type]&&c._behaviorMap[a.type].call(d.view(),
a,a.detail);"function"===typeof c._eventMap[a.type]&&c._eventMap[a.type].call(d.view(),a,a.detail)};var a=c.options(),b=null;if(null!=a.on)for(var e in a.on)b=a.on[e],d.addEvent(d.view(),e,b);if(null!=a.behavior)for(var g in a.behavior)b=a.behavior[g],d.addBehavior(d.view(),g,b);c.controller().call(this,this);return this}var h=n("../helpers/ZxQuery");b.prototype.addEvent=function(c,d,a){this.mapEvent(this.context._eventMap,c,d,a);return this};b.prototype.addBehavior=function(c,d,a){this.mapEvent(this.context._behaviorMap,
c,d,a);return this};b.prototype.field=function(c){return null};b.prototype.clearCache=function(){this._fieldCache.length=0};b.prototype.view=function(c){if(null!=this.context.view()||this._view!==this.context.view())this.clearCache(),this._view=h(this.context.view());if(null!=c)return this._view.find(c);if(null!==this._view)return this._view;throw{message:"Not attacched to a view yet.",source:this};};b.prototype.model=function(c){if(null==c)return this.context.model();this.context.model(c);return this};
b.prototype.options=function(){return this.context.options()};b.prototype.trigger=function(c,d,a){null==this.context._eventMap[c]&&!0!==a&&this.addEvent(this.view(),c,null);!0===a?this.context.trigger(this.context,c,d):this.view().trigger(c,d);return this};b.prototype.expose=function(c,d){this.context[c]=d;return this};b.prototype.loadCss=function(c){this.context.loadCss(c);return this};b.prototype.loadHtml=function(c){this.saveView();this.context.loadHtml(c);return this};b.prototype.log={};b.prototype.for=
function(c){return this};p.exports=b},{"../helpers/ZxQuery":4}],8:[function(n,p,r){function b(){this._fieldCache=[];return this}function h(a,c,d){l.isNoU(d)&&(d=this);null==d._fieldCache&&(d._fieldCache={});var b=null;"undefined"===typeof d._fieldCache[a]?(b=q(c).find('[data-ui-field="'+a+'"]'),null!=b&&(d._fieldCache[a]=b)):b=d._fieldCache[a];return b}function c(a){var b=null;y("zuix").requestLock(c)&&(m.t("componentize:begin","timer:task:start",a,u.length),b=q(a).find("[data-ui-load]:not([data-ui-loaded=true]),[data-ui-include]:not([data-ui-loaded=true])"),
m.t("componentize:count",b.length()),b.each(function(a,b){this.visibility("hidden");var t=b.lazyContainer||q.getClosest(b,"[data-ui-lazyload=scroll]");b.lazyContainer=t;if(!(null!=t&&"force"==t.getAttribute("data-ui-lazyload")||f()&&"false"!=this.attr("data-ui-lazyload")))return d(b),!1;if(null!==t&&(-1==D.indexOf(t)&&(m.t("componentize:lazyload","scroll:container",t),D.push(t),q(t).on("scroll",function(){c(t)})),!q.getPosition(b).visible))return-1==u.indexOf(b)&&(m.t("componentize:lazyload","queue:add",
b),u.push(b)),!0;m.t("componentize:lazyload","queue:load",b);d(b)}),m.t("componentize:end","timer:task:end",a,z.length,v.length),y("zuix").releaseLock(c));null!=b&&b.length()>u.length&&y("zuix").lockLater(c,function(){m.t("componentize:throttle",a);c(a)},10)}function d(c){var d=q(c);if("true"===d.attr("data-ui-loaded")||0<d.parent("pre,code").length())m.w("Skipped",c);else{d.attr("data-ui-loaded","true");var b=d.attr("data-ui-options");l.isNoU(b)?b={}:(b=l.propertyFromPath(window,b),b=l.cloneObject(b)||
{});l.isNoU(b.view)&&!d.isEmpty()?(b.view=c,b.viewDeferred=!0):l.isNoU(b.view)&&l.isNoU(b.container)&&d.isEmpty()&&(b.container=c);var f=d.attr("data-ui-load");l.isNoU(f)&&(f=d.attr("data-ui-include"),d.attr("data-ui-component",f),l.isNoU(b.controller)&&(b.controller=function(){}));var e=d.attr("data-bind-model");!l.isNoU(e)&&0<e.length&&(b.model=l.propertyFromPath(window,e));e=d.attr("data-ui-context");l.isNoU(e)||(b.contextId=e);d=d.attr("data-ui-priority");l.isNoU(d)?b.priority=z.length:b.priority=
d;a(f,b);b=u.indexOf(c);m.t("componentize:lazyload","queue:remove",b,c);-1<b&&u.splice(b,1)}}function a(a,c){var b=null;l.isNoU(c)?(c={},b=new K(c,g)):l.isNoU(c.contextId)?(!1===c&&(c={}),c.contextId="zuix-ctx-"+ ++P,b=x(c)):(b=e(c.contextId),null!==b?b.options(c):b=x(c));b.componentId!=a&&(b.componentId=a);l.isFunction(c.ready)&&(b.ready=c.ready);l.isFunction(c.error)&&(b.error=c.error);var d=I(b.componentId);null!==d&&null==c.controller&&null==b.controller()&&(b.controller(d.controller),m.t("js:"+
b.componentId,"component:cached:js"));if(l.isNoU(c.view)){if(null!==d&&null!=d.view&&(b.view(d.view),m.t("html:"+b.componentId,"component:cached:html"),null!=d.view&&l.isNoU(c.css)&&(c.css=!1,d.css_applied||(d.css_applied=!0,b.style(d.css),m.t("css:"+b.componentId,"component:cached:css")))),l.isNoU(b.view()))return y(b.componentId).queue("html:"+b.componentId,function(){var a=this;b.loadHtml({caching:w,success:function(){!1!==c.css?(a.step("css:"+b.componentId),b.loadCss({caching:w,error:function(a){m.e(a,
b)},then:function(){B(b,a)}})):B(b,a)},error:function(a){m.e(a,b);l.isFunction(c.error)&&b.error.call(b,a)}})},c.priority),b}else b.view(c.view);y(b.componentId).queue("js:"+b.componentId,function(){B(b,this)},z.length);return b}function x(a){a=new K(a,g);z.push(a);return a}function e(a){var b=null;a instanceof q.ZxQuery&&(a=a.get());q.each(z,function(c,d){if(a instanceof Element&&(d.view()===a||d.container()===a)||l.objectEquals(d.contextId,a))return b=d,!1});return b}function g(a,b,d){l.isFunction(E[b])&&
E[b].call(a,d);"view:process"==b&&c(d)}function f(a){null!=a&&(L=!a);return!F&&!L}function k(a){null!=a&&(w=a);return w}function I(a){var b=null;q.each(v,function(c,d){if(l.objectEquals(d.componentId,a))return b=d,!1});return b}function B(a,b){if("undefined"===typeof a.options().controller&&null===a.controller())if(m.d(a.componentId,"controller:load"),l.isNoU(b)||b.step("js:"+a.componentId),l.isFunction(G[a.componentId]))a.controller(G[a.componentId]),C(a,b);else{var c=function(b){q.ajax({url:a.componentId+
".js"+(w?"":"?"+(new Date).getTime()),success:function(b){try{var c=b.indexOf("function"),d=b.indexOf(".load");1<d&&d<c&&(b=b.substring(0,d-4));var f=b.indexOf(".controller");1<f&&f<c&&(b=b.substring(f+11));var e=b.indexOf("//<--controller");0<e&&(b=b.substring(0,e));b+='\n//# sourceURL="'+a.componentId+'.js"\n';a.controller(O(b))}catch(g){m.e(Error(),g,b,a),l.isFunction(a.error)&&a.error.call(a,g)}},error:function(b){m.e(b,Error(),a);l.isFunction(a.error)&&a.error.call(a,b)},then:function(){C(a,
b)}})};l.isNoU(b)?y(a.componentId).queue("js:"+a.componentId,function(){c(this)},a.options().priority):c(b)}else C(a,b)}function N(a){var b=a.view().innerHTML,b=q.wrapElement("div",b),b={componentId:a.componentId,view:b.innerHTML,css:a._css,controller:a.controller()};v.push(b);m.t(a.componentId,"bundle:added");return b}function C(a,b){if(l.isNoU(a.view()))m.e(a.componentId,"component:view:undefined");else{var d=I(a.componentId);a.options().viewDeferred?m.w(a.componentId,"component:deferred:load"):
null===d&&(d=N(a));null!=b&&b.callback(function(){m.d(a.componentId,"controller:create:deferred");J(a._c);c()});m.d(a.componentId,"component:initializing");if(l.isFunction(a.controller())){var f=a._c=new Q(a);f.log=n("../helpers/Logger")(a.contextId);"function"===typeof f.init&&f.init();if(!l.isNoU(f.view()))if(f.view().attr("data-ui-component",a.componentId),l.isNoU(a.model())&&!l.isNoU(a.view())&&a.viewToModel(),f.trigger("view:apply"),a.options().viewDeferred){a.options().viewDeferred=!1;f.saveView();
null===d&&(d={componentId:a.componentId,controller:a.controller()},v.push(d),m.d(a.componentId,"component:deferred:load"));var e=-1;!1!==a.options().css&&(null==d.css?(-1==e&&(e=0),e++,a.loadCss({caching:w,success:function(b){d.css=b;m.d(a.componentId,"component:deferred:css",e)},then:function(){0===--e&&null!=b&&b.end()}})):a.style(d.css));!1!==a.options().html&&(null==d.view?(-1==e&&(e=0),e++,a.loadHtml({caching:w,success:function(b){d.view=b;m.d(a.componentId,"component:deferred:html",e)},then:function(){0===
--e&&null!=b&&b.end()}})):a.view(d.view));-1==e&&null!=b&&b.end()}else null!=b&&b.end();null==b&&(m.d(a.componentId,"controller:create"),J(f))}else m.w(a.componentId,"component:controller:undefined")}}function J(a){a.field=function(b){b=h(b,a.view(),a);b.on=function(b,c,d,f){if("string"===typeof c){var e=c;c=function(){a.trigger(e,d,f)}}q.ZxQuery.prototype.on.call(this,b,c)};return b};l.isFunction(a.create)&&a.create();a.trigger("view:create");a.trigger("component:ready",a.view(),!0);l.isFunction(a.context.ready)&&
a.context.ready.call(a.context);a.view().css("visibility","");m.i(a.context.componentId,"component:loaded",a.context.contextId)}function O(a){var b=function(a){};if("string"===typeof a)try{b=eval.call(this,a)}catch(c){m.e(this,c,a)}return b}var m=n("../helpers/Logger")("Zuix.js"),l=n("../helpers/Util"),q=n("../helpers/ZxQuery"),M=n("../helpers/TaskQueue"),K=n("./ComponentContext"),Q=n("./ContextController"),v=[],P=0,z=[],E=[],G={},u=[],D=[],H=[],y=function(a){l.isNoU(H[a])&&(H[a]=new M(function(a,
b,c){g(a,b,c)}));return H[a]},F=!1,L=!1,w=!0;navigator&&navigator.userAgent&&(F=(new RegExp(/bot|googlebot|crawler|spider|robot|crawling/i)).test(navigator.userAgent));F&&m.d(navigator.userAgent,"is a bot, ignoring 'data-ui-lazyload' option.");b.prototype.controller=function(a){"function"!==typeof a["for"]&&(a["for"]=function(b){return G[b]=a});return a};b.prototype.field=h;b.prototype.componentize=function(a){c(a);return this};b.prototype.load=a;b.prototype.unload=function(a){l.isNoU(a)||l.isNoU(a._c)||
(l.isNoU(a._c.view())||a._c.view().attr("data-ui-component",null),l.isFunction(a._c.destroy)&&a._c.destroy());return this};b.prototype.context=e;b.prototype.trigger=function(a,b,c){g(a,b,c);return this};b.prototype.hook=function(a,b){l.isNoU(b)||(E[a]=b);return this};b.prototype.lazyLoad=function(a){if(null!=a)f(a);else return f();return this};b.prototype.httpCaching=function(a){if(null!=a)k(a);else return k();return this};b.prototype.bundle=function(a,b){if(l.isNoU(a))return v;if(a&&"boolean"===
typeof a){m.t("bundle:start");var d=f();f(!1);c();if("function"===typeof b){var e=function(a){0<u.length?(m.t("bundle:wait"),setTimeout(function(){a(a)},1E3)):(m.t("bundle:end"),f(d),b())};e(e)}}else{for(e=0;e<a.length;e++)a[e].css_applied&&delete a[e].css_applied;v=a}return this};b.prototype.$=q;b.prototype.TaskQueue=M;b.prototype.ZxQuery=q.ZxQuery;b.prototype.dumpCache=function(){m.d("Component Cache",v)};b.prototype.dumpContexts=function(){m.d("Loaded Component Instances",z)};b.prototype.dumpLazyLoaders=
function(){m.d("Loaded Component Instances",D,u,u.length)};p.exports=function(a){var c=new b;"loading"!=document.readyState?c.componentize():document.addEventListener("DOMContentLoaded",function(){c.componentize()});m.monitor(function(a,b){l.isFunction(c.monitor)&&c.monitor(a,Array.prototype.slice.call(b))});return c}},{"../helpers/Logger":1,"../helpers/TaskQueue":2,"../helpers/Util":3,"../helpers/ZxQuery":4,"./ComponentContext":6,"./ContextController":7}]},{},[5])(5)});
//# sourceMappingURL=zuix.min.js.map

/*

 Copyright 2015-2017 G-Labs. All Rights Reserved.
         https://genielabs.github.io/zuix

 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.
*/
!function(r){if("object"==typeof exports)module.exports=r();else if("function"==typeof define&&define.amd)define(r);else{var e;"undefined"!=typeof window?e=window:"undefined"!=typeof global?e=global:"undefined"!=typeof self&&(e=self);e.zuix=r()}}(function(){return function e(g,k,b){function d(a,f){if(!k[a]){if(!g[a]){var m="function"==typeof require&&require;if(!f&&m)return m(a,!0);if(c)return c(a,!0);throw Error("Cannot find module '"+a+"'");}m=k[a]={exports:{}};g[a][0].call(m.exports,function(b){var c=
g[a][1][b];return d(c?c:b)},m,m.exports,e,g,k,b)}return k[a].exports}for(var c="function"==typeof require&&require,a=0;a<b.length;a++)d(b[a]);return d}({1:[function(e,g,k){function b(b){var c=this;c._worker=null;c._taskList=[];c._requests=[];null==b&&(b=function(){});c.taskQueue=function(a,b){c._taskList.push({tid:a,fn:b,status:0,end:function(){this.status=2}});c.check()};c.check=function(){null!=c._worker&&clearTimeout(c._worker);c._worker=setTimeout(function(){c.taskCheck()},10)};c.taskCheck=function(){for(var a=
-1,h=0;h<c._taskList.length;h++)if(-2!=a&&0==c._taskList[h].status)a=h;else{if(1==c._taskList[h].status){c.check();b(c,"load:step",{task:c._taskList[h].tid});return}if(2==c._taskList[h].status){b(this,"load:next",{task:c._taskList[h].tid});c._taskList.splice(h,1);c.check();return}}0<=a?(c._taskList[a].status=1,c._taskList[a].fn.call(c._taskList[a]),c.check(),b(c,"load:begin",{task:c._taskList[a].tid})):b(c,"load:end")}}b.prototype.queue=function(b,c){return this.taskQueue(b,c)};b.prototype.requestLock=
function(b){return null!=b._taskerLock?!1:b._taskerLock=!0};b.prototype.releaseLock=function(b){setTimeout(function(){delete b._taskerLock},100)};b.prototype.lockLater=function(b,c,a){var h=this;null==b._taskerLock?c():null==b._taskerTimeout&&(b._taskerTimeout=!0,b._taskerTimeout=setTimeout(function(){delete b._taskerTimeout;h.lockLater(b,c,a)},a));return!0};g.exports=b},{}],2:[function(e,g,k){g.exports={isNoU:function(b){return"undefined"===typeof b||null===b},isFunction:function(b){return"function"===
typeof b},objectEquals:function(b,d){if(null===b||void 0===b||null===d||void 0===d)return b===d;if(b.constructor!==d.constructor)return!1;if(b instanceof Function||b instanceof RegExp)return b===d;if(b===d||b.valueOf()===d.valueOf())return!0;if(Array.isArray(b)&&b.length!==d.length||b instanceof Date||!(b instanceof Object)||!(d instanceof Object))return!1;var c=Object.keys(b);return Object.keys(d).every(function(a){return-1!==c.indexOf(a)})&&c.every(function(a){return util.objectEquals(b[a],d[a])})},
propertyFromPath:function(b,d){if("string"===typeof d){d=d.replace(/\[(\w+)]/g,".$1");d=d.replace(/^\./,"");for(var c=d.split("."),a=b,h=0,f=c.length;h<f;++h){var m=c[h];if("undefined"!==typeof a[m])a=a[m];else return}return a}},cloneObject:function d(c){if(null===c||"object"!==typeof c)return c;var a=c.constructor(),h;for(h in c)a[h]=d(c[h]);return a},evalJs:eval}},{}],3:[function(e,g,k){function b(a){this._selection=[];"undefined"===typeof a&&(a=document.documentElement);if(a instanceof b)return a;
if(a instanceof HTMLCollection||a instanceof NodeList||Array.isArray(a))this._selection=a;else if(a instanceof HTMLElement||a instanceof Node)this._selection=[a];else if("string"===typeof a)this._selection=document.documentElement.querySelectorAll(a);else if(null!==a)throw console.log(typeof a),a;return this}var d=e("./Util.js");b.prototype.length=function(){return this._selection.length};b.prototype.parent=function(a){return d.isNoU(a)?new b(this._selection[0].parentNode):new b(c.getClosest(this._selection[0],
a))};b.prototype.children=function(a){return d.isNoU(a)?new b(this._selection[0].children):new b(this._selection[0].querySelectorAll(a))};b.prototype.get=function(a){d.isNoU(a)&&(a=0);return this._selection[a]};b.prototype.eq=function(a){return new b(this._selection[a])};b.prototype.find=function(a){return new b(this._selection[0].querySelectorAll(a))};b.prototype.each=function(a){c.each(this._selection,a);return this};b.prototype.css=function(a,b){if(d.isNoU(b))return this._selection[0].style[a];
this.each(function(c,d){this.style[a]=b});return this};b.prototype.attr=function(a,b){if(d.isNoU(b))return this._selection[0].getAttribute(a);this.each(function(c,d){this.setAttribute(a,b)});return this};b.prototype.trigger=function(a,b){var c;window.CustomEvent?c=new CustomEvent(a,{detail:b}):(c=document.createEvent("CustomEvent"),c.initCustomEvent(a,!0,!0,b));this.each(function(a,b){this.dispatchEvent(c)});return this};b.prototype.one=function(a,b){var f=!1;this.on(a,function(d,e){f||(f=!0,c(this).off(a,
b),b.call(this,d,e))});return this};b.prototype.on=function(a,b){var f=a.match(/\S+/g)||[];this.each(function(a,d){var l=this;c.each(f,function(a,c){l.addEventListener(c,b,!1)})});return this};b.prototype.off=function(a,b){var f=a.match(/\S+/g)||[];this.each(function(a,d){var l=this;c.each(f,function(a,c){l.removeEventListener(c,b)})});return this};b.prototype.isEmpty=function(){return 0===this._selection[0].innerHTML.replace(/\s/g,"").length};b.prototype.css=function(a,b){if(d.isNoU(b))return this._selection[0].style[a];
this.each(function(c,d){this.style[a]=b});return this};b.prototype.addClass=function(a){var b=a.match(/\S+/g)||[];c.each(this._selection,function(f,d){if(this.classList){var e=this;c.each(b,function(a,b){e.classList.add(b)})}else this.className+=" "+a});return this};b.prototype.hasClass=function(a){a=a.match(/\S+/g)||[];var b=!1,f=this._selection[0];c.each(a,function(a,c){if(b=f?f.classList.contains(c):(new RegExp("(^| )"+c+"( |$)","gi")).test(f.className))return!1});return b};b.prototype.removeClass=
function(a){var b=a.match(/\S+/g)||[];c.each(this._selection,function(f,d){if(this.classList){var e=this;c.each(b,function(a,b){e.classList.remove(b)})}else this.className=this.className.replace(new RegExp("(^|\\b)"+a.split(" ").join("|")+"(\\b|$)","gi")," ")});return this};b.prototype.prev=function(){return new b(this._selection[0].previousElementSibling)};b.prototype.next=function(){return new b(this._selection[0].nextElementSibling)};b.prototype.html=function(a){if(d.isNoU(a))return this._selection[0].innerHTML;
this.each(function(b,c){this.innerHTML=a});return this};b.prototype.display=function(a){c.each(this._selection,function(b,c){this.style.display=a});return this};b.prototype.show=function(){return this.display("")};b.prototype.hide=function(){return this.display("none")};var c=function(a){return new b(a)};c.find=function(a){return c().find(a)};c.each=function(a,b){for(var c=0,d=a.length;c<d&&!1!==b.call(a[c],c,a[c]);c++);return this};c.ajax=function(a){var b;b=d.isNoU(a)||d.isNoU(a.url)?a:a.url;var c=
new XMLHttpRequest;c.open("GET",b);c.onload=function(){200===c.status?d.isFunction(a.success)&&a.success(c.responseText):d.isFunction(a.error)&&a.error(c)};c.send();return this};c.wrapElement=function(a,b){var c=document.createElement(a);"string"===typeof b?c.innerHTML=b:c.appendChild(b);return c};c.wrapCss=function(a,b){for(var c=/([.,\w])([^/{};]+)({)/g,d,e=null,l="";d=c.exec(b);)null!=e&&(l+=a+" "+b.substring(e.index,d.index)),e=d;null!=e&&(l+=a+" "+b.substring(e.index));""!=l&&(b=l);return b};
c.appendCss=function(a,b){var c=null,e;"string"===typeof a?(e=document.head||document.getElementsByTagName("head")[0],c=document.createElement("style"),c.type="text/css",c.styleSheet?c.styleSheet.cssText=a:c.appendChild(document.createTextNode(a))):a instanceof Element&&(c=a);d.isNoU(b)||e.removeChild(b);d.isNoU(c)||e.appendChild(c);return c};c.getClosest=function(a,b){for(;a&&a!==document;a=a.parentNode)if(a.matches(b))return a;return null};c.getPosition=function(a){for(var b=c.isInView(a),d=0,e=
0;a;){if("BODY"==a.tagName)var g=a.scrollTop||document.documentElement.scrollTop,d=d+(a.offsetLeft-(a.scrollLeft||document.documentElement.scrollLeft)+a.clientLeft),e=e+(a.offsetTop-g+a.clientTop);else d+=a.offsetLeft-a.scrollLeft+a.clientLeft,e+=a.offsetTop-a.scrollTop+a.clientTop;a=a.offsetParent}return{x:d,y:e,visible:b}};c.isInView=function(a){if(null===a.offsetParent)return!1;a=a.getBoundingClientRect();return 0<a.bottom&&0<a.right&&a.left<(window.innerWidth||document.documentElement.clientWidth)&&
a.top<(window.innerHeight||document.documentElement.clientHeight)};c.ZxQuery=b;Element.prototype.matches||(Element.prototype.matches=Element.prototype.matchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector||Element.prototype.oMatchesSelector||Element.prototype.webkitMatchesSelector||function(a){a=(this.document||this.ownerDocument).querySelectorAll(a);for(var b=a.length;0<=--b&&a.item(b)!==this;);return-1<b});g.exports=c},{"./Util.js":2}],4:[function(e,g,k){e=e("./zuix/Zuix.js");
"object"===typeof g&&g.exports?g.exports=e.call(this):this.zuix=e.call(this)},{"./zuix/Zuix.js":7}],5:[function(e,g,k){function b(a,b){this._options=null;this.contextId=null==a||null==a.contextId?null:a.contextId;this.componentId=null;this.trigger=function(a,c,d){"function"===typeof b&&b(a,c,d)};this.behavior=this._controller=this._style=this._css=this._view=this._model=this._container=null;this._eventMap=[];this._behaviorMap=[];this._c=null;this.options(a);return this}var d=e("../helpers/ZxQuery"),
c=e("../helpers/Util");b.prototype.options=function(a){if(null==a)return this._options;this._options=a;null!=a.componentId&&(this.componentId=a.componentId);this.container(a.container);this.view(a.view);"undefined"!==typeof a.css&&this.style(a.css);this.controller(a.controller);this.model(a.model);return this};b.prototype.ready=function(a){};b.prototype.error=function(a,b){};b.prototype.on=function(a,b){return this._c.on(a,b)};b.prototype.invoke=function(a,b){return this._c.invoke(a,b)};b.prototype.model=
function(a){if("undefined"===typeof a)return this._model;this._model=a;this.updateModelView();return this};b.prototype.updateModelView=function(){if(null!=this._view&&null!=this._model){var a=this;d(this._view).find("[data-ui-field]").each(function(){var b=d(this),e=b.attr("data-bind-to");null==e&&(e=b.attr("data-ui-field"));if("function"===typeof a._model)a._model.call(a._view,this,e);else if(b=c.propertyFromPath(a._model,e),"function"===typeof b)b.call(a._view,this,e);else if(null!=b)switch(this.tagName.toLowerCase()){case "img":this.src=
b;break;case "input":this.value=b;break;default:this.innerHTML=b}})}};b.prototype.style=function(a){if("undefined"===typeof a)return this._style;null==a||a instanceof Element?(this._css=a instanceof Element?a.innerText:a,this._style=d.appendCss(a,this._style)):"string"===typeof a&&(this._css=a,a=d.wrapCss('[data-ui-component="'+this.componentId+'"]:not(.zuix-css-ignore)',a),a={content:a},this.trigger(this,"css:parse",a),a=a.content,this._style=d.appendCss(a,this._style));return this};b.prototype.view=
function(a){if("undefined"===typeof a)return this._view;"string"===typeof a?(a={content:a},this.trigger(this,"html:parse",a),a=a.content,null!=this._container?(this._view=this._container,this._view.innerHTML+=a):this._view=d.wrapElement("div",a),d(this._view).find("script").each(function(){"true"!==this.getAttribute("zuix-loaded")&&(this.setAttribute("zuix-loaded","true"),eval.call(window,this.innerHTML))}),this.trigger(this,"view:process",this._view),this.updateModelView()):null!=this._container?
(this._view=d.wrapElement("div",a.outerHTML).firstElementChild,this._view.removeAttribute("data-ui-view"),this._container.appendChild(this._view),this._view=this._container):this._view=a;a=d(this._view);!1===this._options.css?a.addClass("zuix-css-ignore"):a.removeClass("zuix-css-ignore");return this};b.prototype.controller=function(a){if("undefined"===typeof a)return this._controller;this._controller=a;return this};b.prototype.container=function(a){if(null==a)return this._container;this._container=
a;return this};g.exports=b},{"../helpers/Util":2,"../helpers/ZxQuery":3}],6:[function(e,g,k){function b(b){var a=this;this.context=b;this.componentId=b.componentId;this.view=function(){return b.view()};this.model=function(){return b.model()};this.expose=function(a,d){b[a]=d};this.behavior=function(){return b.behavior};this.mapEvent=function(a,b,c,e){null!=b&&(b=d(b),b.off(c,this.eventRouter),a[c]=e,b.on(c,this.eventRouter))};this._fieldCache=[];this.api=this.event=this.refresh=this.destroy=this.pause=
this.resume=this.create=null;this.trigger=function(e,h){null==b._eventMap[e]&&this.addEvent(a.view(),e,null);d(a.view()).trigger(e,h)};this.on=function(b,c){this.addEvent(a.view(),b,c)};this.invoke=function(b,c){"function"===typeof a.api&&a.api(b,c)};this.eventRouter=function(d){"function"===typeof b._behaviorMap[d.type]&&b._behaviorMap[d.type].call(a.view(),d,d.detail);"function"===typeof b._eventMap[d.type]&&b._eventMap[d.type].call(a.view(),d,d.detail)};var e=b.options(),f=null;if(null!=e.on)for(var g in e.on)f=
e.on[g],a.addEvent(a.view(),g,f);if(null!=e.behavior)for(var k in e.behavior)f=e.behavior[k],a.addBehavior(a.view(),k,f);b.controller().call(this,this);return this}var d=e("../helpers/ZxQuery");b.prototype.addEvent=function(b,a,d){this.mapEvent(this.context._eventMap,b,a,d);return this};b.prototype.addBehavior=function(b,a,d){this.mapEvent(this.context._behaviorMap,b,a,d);return this};b.prototype.field=function(b,a){var e=a?"@"+b:b,f=null;"undefined"===typeof this._fieldCache[e]?(f=a?d(b).get(0):
d(this.view()).find("[data-ui-field="+b+"]").get(0),null!=f&&(this._fieldCache[e]=f)):f=this._fieldCache[e];return f};b.prototype.clearCache=function(){this._fieldCache.length=0};g.exports=b},{"../helpers/ZxQuery":3}],7:[function(e,g,k){var b=e("../helpers/Util"),d=e("../helpers/TaskQueue"),c=e("../helpers/ZxQuery");g.exports=function(){function a(b){n.requestLock(a)?(c(b).find("[data-ui-load]:not([data-ui-loaded=true]),[data-ui-include]:not([data-ui-loaded=true])").each(function(){if(v||"false"==
this.getAttribute("data-ui-lazyload"))return g(this),!0;var b=c.getClosest(this,"[data-ui-lazyload=true]");if(null!==b&&(-1==A.indexOf(b)&&(A.push(b),c(b).on("scroll",function(){a(b)})),!c.getPosition(this).visible))return-1==p.indexOf(this)&&p.push(this),!0;var d=p.indexOf(this);-1<d&&p.splice(d,1);g(this)}),n.releaseLock(a)):n.lockLater(a,function(){a(b)},200)}function g(a){var d=c(a);if("true"===d.attr("data-ui-loaded")||0<d.parent("pre,code").length())console.log("ZUIX","WARN","Skipped",a);else{d.attr("data-ui-loaded",
"true");var e=d.attr("data-ui-options");b.isNoU(e)?e={}:(e=b.propertyFromPath(window,e),e=b.cloneObject(e)||{});b.isNoU(e.view)&&!d.isEmpty()?e.view=a:b.isNoU(e.view)&&b.isNoU(e.container)&&d.isEmpty()&&(e.container=a);a=d.attr("data-ui-load");b.isNoU(a)&&(a=d.attr("data-ui-include"),d.attr("data-ui-component",a),b.isNoU(e.controller)&&(e.controller=function(){}));d=d.attr("data-bind-model");!b.isNoU(d)&&0<d.length&&(e.model=b.propertyFromPath(window,d));f(a,e)}}function f(a,d){var e=null;b.isNoU(d)?
(d={},e=new B(d,w)):b.isNoU(d.contextId)?(!1===d&&(d={}),d.contextId="zuix-ctx-"+ ++D,e=z(d)):(e=k(d.contextId),null!==e?e.options(d):e=z(d));e.componentId!=a&&(e.componentId=a);var f=l(e.componentId);null!==f&&b.isNoU(e.controller())&&e.controller(f.controller);b.isFunction(d.ready)&&(e.ready=d.ready);b.isFunction(d.error)&&(e.error=d.error);if(b.isNoU(d.view)){if(null!==f?e.view(f.view):(f=c().find('[data-ui-view="'+e.componentId+'"]'),0<f.length()&&e.view(f.get(0))),b.isNoU(e.view()))return n.queue("html:"+
e.componentId,function(){var a=this;c.ajax({url:e.componentId+".html?"+(new Date).getTime(),success:function(b){e.view(b);a.end();!1!==d.css?C(e,function(){t(e)}):t(e)},error:function(c){a.end();console.log(c,e);b.isFunction(d.error)&&e.error(e,c)}})}),e}else e.view(d.view);t(e);return e}function k(a){var d=null;c.each(x,function(c,e){if(a instanceof Node&&e.view()===a||b.objectEquals(e.contextId,a))return d=e,!1});return d}function z(a){a=new B(a,w);x.push(a);return a}function l(a){var d=null;c.each(y,
function(c,e){if(b.objectEquals(e.componentId,a))return d=e,!1});return d}function C(a,d){n.queue("css:"+a.componentId,function(){var e=this;c.ajax({url:a.componentId+".css?"+(new Date).getTime(),success:function(c){a.style(c);e.end();b.isFunction(d)&&d.call(a)},error:function(c){e.end();console.log(c,a);b.isFunction(d)&&d.call(a)}})})}function t(a){"undefined"===typeof a.options().controller&&null===a.controller()?n.queue("js:"+a.componentId,function(){var d=this;c.ajax({url:a.componentId+".js?"+
(new Date).getTime(),success:function(c){try{var e=c.indexOf(".load");1<e&&(c=c.substring(0,e-4));var f=c.indexOf(".controller");1<f&&(c=c.substring(f+11));a.controller(E(c))}catch(g){console.log(g,c,a);b.isFunction(a.error)&&a.error(a,g);return}u(a);d.end()},error:function(c){d.end();u(a);console.log(c,a);b.isFunction(a.error)&&a.error(a,c)}})}):u(a)}function u(a){if(!b.isNoU(a.view())){if(null===l(a.componentId)){var d=a.view()===a.container()?a.view().innerHTML:a.view().outerHTML,d=c.wrapElement("div",
d);y.push({componentId:a.componentId,view:d.innerHTML,controller:a.controller()})}b.isFunction(a.controller())&&(d=a._c=new F(a),b.isNoU(d.view())||d.view().setAttribute("data-ui-component",d.componentId),b.isFunction(d.create)&&d.create(),d.trigger("view:create"),a.updateModelView(),b.isFunction(d.resume)&&d.resume());b.isFunction(a.ready)&&a.ready(a)}}function E(a){var b=function(a){};"string"===typeof a&&(b=eval.call(this,a));return b}function w(c,d,e){b.isFunction(q[d])&&q[d].call(c,d,e);"view:process"==
d&&a(e)}function G(a,c){if(b.isNoU(c))return q[a];q[a]=c;return this}var B=e("./ComponentContext"),F=e("./ContextController"),n=new d(function(a,b,c){w(a,b,c)}),y=[],x=[],D=0,p=[],A=[],q=[],v=!1;navigator&&navigator.userAgent&&(v=(new RegExp(/bot|googlebot|crawler|spider|robot|crawling/i)).test(navigator.userAgent));v&&console.log(navigator.userAgent,"is a bot, ignoring 'data-ui-lazyload' option.");return{controller:function(a){return a},load:f,unload:function(a){b.isNoU(a)||b.isNoU(a._c)||(b.isNoU(a._c.view())||
a._c.view().removeAttribute("data-ui-component"),b.isFunction(a._c.destroy)&&a._c.destroy())},componentize:a,context:k,hook:function(a,b){G(a,b);return this},$:c,field:function(a,b){return c(b).find('[data-ui-field="'+a+'"]').get(0)},TaskQueue:d,ZxQuery:c.ZxQuery,dumpCache:function(){console.log("ZUIX","Component Cache",y)},dumpContexts:function(){console.log("ZUIX","Loaded Component Instances",x)}}}},{"../helpers/TaskQueue":1,"../helpers/Util":2,"../helpers/ZxQuery":3,"./ComponentContext":5,"./ContextController":6}]},
{},[4])(4)});
//# sourceMappingURL=zuix.min.js.map
